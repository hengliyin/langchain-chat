# 🎯 对话历史功能 - 完整操作指南

## 1️⃣ 启动应用

```bash
# 安装依赖（如果还没有）
npm install

# 启动开发服务器
npm run dev
```

预期输出：
```
server running at http://localhost:3000
```

## 2️⃣ 打开 Web 界面

在浏览器中访问：`http://localhost:3000`

你会看到一个聊天界面，包含以下功能：
- 💬 消息输入框
- 📤 发送按钮
- 📋 对话列表
- ➕ 新建对话
- 🗑️ 清空对话
- 📥 导出对话
- 📊 模型选择
- 🌡️ 温度设置

## 3️⃣ 测试对话历史

### 方式一：手动测试（推荐）

在 Web 界面中进行以下对话：

```
第1条消息：
  输入: "你好，我叫张三"
  点击: 发送
  AI回复: "你好张三，很高兴认识你！"

第2条消息：
  输入: "我喜欢编程"
  点击: 发送
  AI回复: "很好的爱好！编程很有趣。"

第3条消息（验证记忆）：
  输入: "我叫什么名字？我喜欢什么？"
  点击: 发送
  ✅ 验证: AI 是否提到了 "张三" 和 "编程"
```

如果 AI 在回复中提到了你之前说过的"张三"和"编程"，说明对话历史功能正常工作！

### 方式二：自动测试

```bash
# 运行测试脚本
npm run test:conversation
# 或者使用 npm test
```

脚本会自动进行 3 轮对话，并在最后显示完整的对话历史。

## 4️⃣ 验证功能是否工作

### 检查点 1：查看网络请求

1. 打开浏览器开发者工具（F12）
2. 切换到 **Network** 标签
3. 在聊天框中发送一条消息
4. 找到 `chat` 的 POST 请求
5. 点击该请求，查看 **Request** 标签
6. 在 **Request Body** 中应该看到 `history` 字段，包含之前的对话

示例请求体：
```json
{
  "message": "我叫什么名字？",
  "model": "gpt-4o-mini",
  "temperature": 0.7,
  "history": [
    {
      "role": "user",
      "content": "我叫张三"
    },
    {
      "role": "ai",
      "content": "你好张三！"
    }
  ]
}
```

### 检查点 2：查看浏览器本地存储

1. 打开浏览器开发者工具（F12）
2. 切换到 **Application** 或 **Storage** 标签
3. 在左侧菜单中找到 **Local Storage**
4. 点击 `http://localhost:3000` 条目
5. 查找 `chatHistory` 键
6. 点击查看其值，应该包含完整的对话记录

示例存储数据：
```json
{
  "history": {
    "chat_1_1234567890": {
      "id": "chat_1_1234567890",
      "title": "你好，我叫张三",
      "messages": [
        {
          "role": "user",
          "content": "你好，我叫张三",
          "timestamp": "14:30:45"
        },
        {
          "role": "ai",
          "content": "你好张三！",
          "timestamp": "14:30:46"
        }
      ],
      "createdAt": "2024-11-14 14:30:45"
    }
  },
  "counter": 1
}
```

### 检查点 3：查看服务器日志

在服务器终端中，应该能看到请求日志：
```
POST /api/chat - 200 OK
```

## 5️⃣ 功能演示场景

### 场景 1：个人信息记忆

```
用户: 我是一名前端工程师，2年工作经验
AI:  你好！很高兴认识一名前端工程师。

用户: 我用什么技术栈？
AI:  根据你的介绍，你是一名前端工程师。你具体使用什么技术栈呢？

用户: React 和 Vue
AI:  很不错！React 和 Vue 都是很流行的前端框架。
     作为一名 2 年经验的前端工程师...

用户: 给我一个我技术栈的学习路线图
AI:  根据你的 React 和 Vue 经验...
     [会基于你的信息给出个性化建议]
```

### 场景 2：对话上下文保持

```
用户: 用 JavaScript 写一个 TODO 列表应用
AI:  这是一个不错的项目！[给出代码]

用户: 怎样添加本地存储功能？
AI:  基于前面的代码，可以这样添加本地存储...
     [参考之前的代码结构给出相关修改]

用户: 这个能支持多个用户吗？
AI:  这取决于你是否要添加后端...
     [基于前面的讨论进行扩展]
```

### 场景 3：项目开发辅助

```
用户: 我在做一个 Express.js 项目
AI:  很好！Express 是一个很流行的框架。

用户: 我需要添加身份验证功能
AI:  对于你的 Express 项目，可以使用 JWT...
     [给出针对 Express 的身份验证方案]

用户: 推荐一下中间件
AI:  对于 Express 项目，我推荐以下中间件...
     [基于 Express.js 的特性推荐]
```

## 6️⃣ 常见操作

### 开始新对话

1. 点击左侧的 **➕ 新建对话** 按钮
2. 对话历史会被清空，开始新的对话线程
3. 之前的对话保存在左侧列表中

### 切换到之前的对话

1. 在左侧对话列表中找到要切换的对话
2. 点击对话标题
3. 会加载该对话的所有消息历史

### 清空当前对话

1. 点击左侧的 **🗑️ 清空对话** 按钮
2. 确认删除
3. 当前对话的所有消息将被清除

### 导出对话

1. 点击左侧的 **📥 导出对话** 按钮
2. 系统会生成一个 `.txt` 文件
3. 文件包含完整的对话内容

示例导出格式：
```
=== 你好，我叫张三 ===
创建时间: 2024-11-14 下午 2:30:45

[14:30:45] 👤 用户:
你好，我叫张三

[14:30:46] 🤖 AI:
你好张三，很高兴认识你！

[14:35:22] 👤 用户:
我是一名前端工程师

[14:35:24] 🤖 AI:
很好！前端工程是一个很有前景的工作...
```

## 7️⃣ 高级功能

### 自定义 AI 模型

1. 找到顶部的 **Model** 下拉菜单
2. 选择不同的模型（默认 gpt-4o-mini）
3. 后续消息会使用新选择的模型

### 调整 AI 创意度

1. 使用 **Temperature** 滑块
2. 数值越低（接近 0）：AI 回复更确定、更一致
3. 数值越高（接近 2）：AI 回复更创意、更随机

### 流式 vs 普通模式

1. 找到 **Stream** 开关
2. 打开（蓝色）：实时流式显示 AI 回复
3. 关闭（灰色）：等待完整回复后一次性显示

## 8️⃣ 故障排除

### 问题 1：AI 不记得之前的信息

**症状**: 问了用户名字，但 AI 说"不知道你是谁"

**解决方案**:
1. 检查浏览器开发者工具 Network 标签
2. 确认请求中有 `history` 字段
3. 确认服务器在正常运行
4. 查看浏览器控制台是否有错误

### 问题 2：提示"连接失败"

**症状**: 发送消息后收到错误

**解决方案**:
1. 检查服务器是否在运行：`npm run dev`
2. 确保地址是 `http://localhost:3000`
3. 检查是否有防火墙阻止
4. 查看服务器日志了解详情

### 问题 3：消息很慢才显示

**症状**: 点击发送很久才有回复

**解决方案**:
1. 对话历史很长时，API 会变慢
2. 考虑开始新对话来重置
3. 查看是否因为网络延迟

## 9️⃣ 性能优化建议

对于很长的对话（>100 条消息）：

1. **开始新对话**: 点击新建对话，AI 不需要处理冗长历史
2. **导出旧对话**: 使用导出功能备份，然后清空
3. **清理历史**: 定期清理重要性不大的对话

## 🔟 获取帮助

查看以下文档了解更多信息：

1. **`IMPLEMENTATION_SUMMARY.md`** - 实现细节和技术说明
2. **`CONVERSATION_HISTORY.md`** - 功能详细文档和改进方向
3. **`CONVERSATION_QUICK_START.md`** - 快速参考和常见问题
4. **`test-conversation.js`** - 测试脚本源代码

---

**现在开始对话吧！** 🚀

记住：AI 现在能够理解完整的对话上下文，提供更有针对性的帮助！
